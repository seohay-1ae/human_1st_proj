<!doctype html>
<html lang="ko">
	<head>
		<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
		<link rel="stylesheet" href="../common/styles.css" />
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>커뮤니티 게시판</title>
		<style>
			/* 기본 세팅: 전체 높이 확보 및 플렉스 레이아웃 구성 */
			html,
			body {
				height: 100%; /* 화면 전체 높이 사용 */
				margin: 0;
				padding: 0;
			}

			body {
				background-color: #f4f4f4;
				display: flex; /* body 자체에 flex , center, center 적용하면 있어서 푸터가 가로중앙+수직중앙 정렬됨 */
				flex-direction: column; /* 수직 방향 레이아웃 */
			}

			.wrapper {
				/* body에 정렬하면 전체 레이아웃 꼬이므로 wrapper로 감싸서 그 안에 컨텐츠를 넣고 정렬, footer는 wrapper 밖에 */
				flex: 1; /* 남은 공간을 채움 (푸터 밀어내기 용도) */
				display: flex;
				flex-direction: column;
				align-items: center; /* 가운데 정렬 */
				padding: 20px;
				margin-top: 100px;
			}

			.container {
				width: 90%;
				max-width: 1000px;
				margin: auto;
				background: #f4f4f4;
				padding: 20px;
				box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
				border-radius: 10px;
			}

			.header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 20px;
			}

			.header h2 {
				margin: 0;
				color: #333;
			}

			.write-button {
				color: white;
				padding: 10px 20px;
				font-size: 1rem; /* 폰트 크기 줄임 */
				border: none;
				border-radius: 8px;
				text-decoration: none;
				font-weight: bold;
				transition: background-color 0.3s;
				display: inline-block; /* 버튼처럼 보이도록 설정. 부모 컨테이너의 너비를 차지함 (버튼 안의 글씨를 정확히 클릭하지 않아도 되도록) */
				background-color: #0a8b11;
			}

			.search-container {
				margin: 20px 0;
			}

			.search-input {
				padding: 0;
				font-size: 1rem;
				border: 1px solid #ccc;
				border-radius: 5px;
				width: 100%;
				margin-right: 1rem;
				height: 2.5rem;
			}

			table {
				width: 100%;
				border-collapse: collapse;
				text-align: left;
				table-layout: fixed; /* 열 너비 강제 적용 */
			}

			th,
			td {
				padding: 12px;
				border-bottom: 1px solid #ddd;
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
			}

			th {
				background-color: #f0f0f0;
			}

			tr:hover {
				background-color: #f9f9f9;
			}

			a {
				text-decoration: none;
				color: #000;
			}
			.pc_table-filter label {
				display: inline-block;
				margin-right: 10px;
				margin-bottom: 5px;
			}
			/* 열 너비 지정 */
			td.no {
				width: 6%;
			}
			td.title {
				width: 20%;
			}
			td.preview {
				width: 40%;
				white-space: nowrap;       /* 한 줄로 표시 */
				overflow: hidden;          /* 넘치면 잘림 */
				text-overflow: ellipsis;   /* ... 처리 */
			}
			td.author {
				width: 14%;
			}
			td.date {
				width: 20%;
			}
			.card-list {
				display: none;
			}

			.card {
				background: white;
				margin-bottom: 15px;
				padding: 15px;
				border-radius: 10px;
				box-shadow: 0 2px 5px rgba(0,0,0,0.1);
			}

			.card h4 {
				margin: 0 0 8px;
				font-size: 1.1rem;
			}

			.card p {
				margin: 4px 0;
				font-size: 0.9rem;
			}
			.clickable-row {
				cursor: pointer;
			}

			@media (min-width: 768px) {
				.mobile-filter{
					display:none;
				}
			}
			/* 모바일 */
			@media (max-width: 767px) {
				table {
					word-break: keep-all;
					display: none;
				}
				td {
					word-break: break-word;
				}
				.pc_table-filter{
					display:none;
				}
				.mobile-filter label {
					display: inline-block; /* 또는 block */
					margin-right: 10px; /* 옆 간격 */
					margin-bottom: 5px; /* 아래 여백 */
				}
				td.preview {
					white-space: normal;
					overflow: visible;
					text-overflow: unset;
				}
				.card-list {
				display: block;
				}
				#search{
					margin-bottom:1rem;
					}
				}
		</style>
	</head>
	<body>
		<!-- 전체 콘텐츠를 감싸는 wrapper -->
		<div class="wrapper">
			<div class="container">
				<div class="header">
					<h3>커뮤니티 게시판</h3>
					<a href="./write.html" class="write-button">글쓰기</a>
				</div>

				<!-- 검색창 -->
				<div class="search-container">
					<div class="pc_table-filter">
						<div style="margin-bottom: 20px">
							<label><input type="checkbox" class="search-option" value="no" /> NO.</label>
							<label><input type="checkbox" class="search-option" value="title" checked /> 제목</label>
							<label><input type="checkbox" class="search-option" value="content" checked /> 내용</label>
							<label><input type="checkbox" class="search-option" value="author" /> 작성자</label>
							<label><input type="checkbox" class="search-option" value="date" /> 작성일</label>
						</div>
					</div>
						<div class="mobile-filter">
							<div style="margin-bottom: 20px">
								<div>
									<label><input type="checkbox" class="search-option" value="no" /> NO.</label>
									<label><input type="checkbox" class="search-option" value="title" checked /> 제목</label>
									<label><input type="checkbox" class="search-option" value="content" checked /> 내용</label>
								</div>
								<br />
								<label><input type="checkbox" class="search-option" value="author" /> 작성자</label>
								<label><input type="checkbox" class="search-option" value="date" /> 작성일</label>
							</div>
						</div>
						<input
							type="text"
							id="search"
							class="search-input"
							placeholder="&nbsp;게시글 검색..."
						/>

				<!-- 게시글 목록 -->
				<table>
					<colgroup>
						<col style="width: 10%" />
						<col style="width: 15%" />
						<col style="width: 40%" />
						<col style="width: 14%" />
						<col style="width: 17%" />
					</colgroup>
					<thead>
						<tr>
							<th>NO.</th>
							<th>제목</th>
							<th>내용</th>
							<th>작성자</th>
							<th>작성일</th>
						</tr>
					</thead>
					<tbody id="post-list">
						<!-- 게시글 목록이 여기 렌더링됨 -->
					</tbody>
				</table>
				<!-- 카드 리스트용 div (모바일용) -->
				<div class="card-list" ></div>
			</div>
		</div>

		<script>
			$(document).ready(function () {
				// 로컬스토리지에서 posts 가져오기 (없으면 빈 배열)
				let rawPosts = JSON.parse(localStorage.getItem('posts')) || [];
		
				// 게시글 번호(no)를 미리 계산해서 각 게시글 객체에 추가
				let posts = rawPosts.map((post, i, arr) => ({
					...post,
					no: arr.length - i, // 최신글이 no 1, 가장 오래된 글이 no N
				}));
		
				// 게시글 목록을 테이블/카드 형태로 렌더링하는 함수
				function displayPosts(filteredPosts) {
					$('#post-list').empty();     // 테이블용 목록 비우기
					$('.card-list').empty();     // 카드용 목록 비우기
		
					const isMobile = window.innerWidth <= 767;
		
					// 검색 결과가 없을 경우 표시
					if (filteredPosts.length === 0) {
						$('#post-list').html('<tr><td colspan="5" style="text-align:center;">검색 결과가 없습니다.</td></tr>');
						$('.card-list').html('<div style="text-align:center; padding:1rem;">검색 결과가 없습니다.</div>');
						return;
					}
		
					// 필터된 게시글 하나씩 렌더링
					filteredPosts.forEach((post) => {
						// 현재 게시글의 원래 인덱스를 찾아서 post.html?index= 로 전달
						const index = posts.findIndex(p =>
							p.title === post.title &&
							p.content === post.content &&
							p.author === post.author &&
							p.date === post.date
						);
		
						// 테이블 뷰용 HTML 추가
						$('#post-list').append(`
								<tr class="clickable-row" data-index="${index}">
									<td class="no">${post.no}</td>
									<td class="title">${post.title}</td>
									<td class="preview">${post.content || ''}</td>
									<td class="author">${post.author}</td>
									<td class="date">${post.date}</td>
								</tr>
						`);
		
						// 모바일 카드 뷰용 HTML 추가
						if (isMobile) {
							$('.card-list').append(`
								<div class="card">
									<h4><a href="./post.html?index=${index}">${post.title}</a></h4>
									<p><strong>내용:</strong> ${post.content || ''}</p>
									<p><strong>작성자:</strong> ${post.author}</p>
									<p><strong>작성일:</strong> ${post.date}</p>
								</div>
							`);
						}
					});
				}

				// 게시글 리스트에서 각 행 클릭 시 해당 게시글로 이동
				$(document).on('click', '.clickable-row', function () {
					const index = $(this).data('index');
					window.location.href = `./post.html?index=${index}`;
				});
		
				// 검색 필터링 함수
				function applySearch() {
					const searchQuery = $('#search').val().toLowerCase(); // 검색어 소문자로
					// 체크된 검색 필드 값 배열로 추출
					const selectedOptions = [...new Set(
						$('.search-option:checked:visible')
							.map(function () {
								return $(this).val();
							})
							.get()
					)];
		
					console.log("검색어:", searchQuery);
					console.log("선택된 필드:", selectedOptions);

					// 검색어가 없으면 전체 게시글 보여주기
					if (!searchQuery) {
						displayPosts(posts);
						return;
					}
		
					// 필터링된 게시글 목록 생성
					const filteredPosts = posts.filter((post) => {
						return selectedOptions.some((key) => {
							if (key === 'no') {
								// 번호는 숫자지만 검색어는 문자열이라 문자열로 변환 후 비교
								return post.no.toString().includes(searchQuery);
							}
							// 나머지 필드는 문자열 포함 여부 확인
							return (
								typeof post[key] === 'string' &&
								post[key].toLowerCase().includes(searchQuery)
							);
						});
					});
		
					// 필터링된 게시글 표시
					displayPosts(filteredPosts);
				}
		
				// 초기 전체 게시글 표시
				displayPosts(posts);
		
				// 검색창 입력 시 필터링
				$('#search').on('input', applySearch);
		
				// 검색 옵션 변경 시 필터링
				$('.search-option').on('change', applySearch);
			});
		</script>
		
		
		

		<!-- 공통 헤더 및 푸터 스크립트 로드 (바디 맨 아래에 삽입)-->
		<script defer src="../common/header3.js"></script>
		<script defer src="../common/footer2.js"></script>
	</body>
</html>
