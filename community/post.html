<!doctype html>
<html lang="ko">
	<head>
		<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
		<link rel="stylesheet" href="../common/styles.css" />
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>게시글 상세보기</title>
		<style>
			body {
				font-family: 'Arial', sans-serif;
				background-color: #f4f4f4;
				padding: 20px;
			}
			.container {
				max-width: 600px;
				margin-top: 100px;
				background: white;
				padding: 20px;
				border-radius: 10px;
				box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
				position: relative;
			}
			.post-title {
				font-size: 1.8rem;
				font-weight: bold;
				margin-bottom: 10px;
				padding-right: 80px; /* 버튼을 위한 여백 */
			}
			.post-author {
				font-size: 1rem;
				color: #555;
			}
			.post-date {
				font-size: 1rem;
				color: #888;
			}
			.post-content {
				margin-top: 20px;
			}
			.post-image img {
				max-width: 100%; /* 화면 너비에 맞게 이미지 크기 조정 */
				height: auto; /* 비율에 맞게 높이 자동 조정 */
				border-radius: 10px; /* 이미지 모서리 둥글게 처리 */
			}
			.comment-section {
				margin-top: 30px;
			}
			.comment-input {
				width: 100%;
				padding: 10px;
				margin: 10px 0;
				border-radius: 5px;
				border: 1px solid #ccc;
				font-size: 1rem;
			}
			.comment-button {
				color: white;
				padding: 10px 20px;
				border: none;
				border-radius: 8px;
				font-weight: bold;
				cursor: pointer;
			}
			.comment-list {
				margin-top: 20px;
			}
			.comment {
				padding: 10px;
				background-color: #f9f9f9;
				margin-bottom: 10px;
				border-radius: 5px;
			}
			.comment-time {
				font-size: 0.9rem;
				color: #888;
				margin-top: 5px;
			}
			.back-button {
				background-color: #ccc;
				color: white;
				margin-top: 10px;
				padding: 10px 20px;
				border-radius: 8px;
				text-decoration: none;
				font-weight: bold;
				position: absolute;
				top: 10px;
				right: 20px; /* 오른쪽 상단에 위치 */
				background-color: #0a8b11;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h2 class="post-title" id="post-title"></h2>
			<div class="post-author" id="post-author"></div>
			<div class="post-date" id="post-date"></div>
			<div class="post-content" id="post-content"></div>
			<div class="post-image" id="post-image"></div>

			<!-- 댓글 섹션 -->
			<div class="comment-section">
				<h3>댓글</h3>
				<input type="text" id="comment" class="comment-input" placeholder="댓글을 작성해주세요." />
				<button id="submit-comment" class="comment-button">댓글 작성</button>
				<div class="comment-list" id="comment-list"></div>
			</div>

			<!-- 커뮤니티 페이지로 돌아가는 버튼 -->
			<a href="community.html" class="back-button">커뮤니티로 돌아가기</a>
		</div>

		<script>
			$(document).ready(function () {
				const urlParams = new URLSearchParams(window.location.search);
				const postIndex = urlParams.get('index'); // URL에서 게시글의 index 값 가져오기

				const posts = JSON.parse(localStorage.getItem('posts')) || [];
				const post = posts[postIndex];

				if (post) {
					$('#post-title').text(post.title);
					$('#post-author').text(`작성자: ${post.author}`);
					$('#post-date').text(`작성일: ${post.date}`);
					$('#post-content').text(post.content);

					// 이미지가 있다면 표시
					if (post.image) {
						$('#post-image').html(`<img src="${post.image}" alt="게시글 이미지" />`);
					}

					// 댓글 로드
					const comments = JSON.parse(localStorage.getItem(`comments_${postIndex}`)) || [];
					comments.forEach(({ comment, time }) => {
						$('#comment-list').append(`
                        <div class="comment">
                            ${comment}
                            <div class="comment-time">${time}</div>
                        </div>
                    `);
					});

					// 댓글 작성
					$('#submit-comment').click(function () {
						const comment = $('#comment').val().trim();

						if (comment) {
							const time = new Date().toLocaleString(); // 현재 시간을 읽어서 지역화된 시간 문자열로 변환

							const newComment = { comment, time };
							comments.push(newComment);
							localStorage.setItem(`comments_${postIndex}`, JSON.stringify(comments));

							$('#comment').val(''); // 댓글 입력 필드 비우기
							$('#comment-list').append(`
                            <div class="comment">
                                ${comment}
                                <div class="comment-time">${time}</div>
                            </div>
                        `);
						} else {
							alert('댓글을 입력해주세요.');
						}
					});
				} else {
					alert('해당 게시글을 찾을 수 없습니다.');
				}
			});
		</script>
		<!-- 공통 헤더 및 푸터 스크립트 로드 (바디 맨 아래에 삽입)-->
		<script defer src="/common/header2.js"></script>
		<script defer src="/common/footer2.js"></script>
	</body>
</html>
