<!doctype html>
<html lang="ko">
	<head>
		<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
		<link rel="stylesheet" href="../common/styles.css" />
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>글쓰기</title>
		<style>
			body {
				font-family: 'Arial', sans-serif;
				background-color: #f4f4f4;
				padding: 20px;
			}
			.container {
				max-width: 600px;
				margin: auto;
				background: white;
				padding: 20px;
				border-radius: 10px;
				box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
				margin-top: 100px;
			}
			input,
			textarea {
				width: 100%;
				padding: 10px;
				margin: 10px 0;
				border-radius: 5px;
				border: 1px solid #ccc;
				font-size: 1rem;
			}
			button {
				color: white;
				padding: 10px 20px;
				border: none;
				border-radius: 8px;
				font-weight: bold;
				cursor: pointer;
			}
			.back-button {
				color: white;
				margin-top: 10px;
				padding: 10px 20px;
				border-radius: 8px;
				text-decoration: none;
				font-weight: bold;
				background-color: #0a8b11;
				font-size: 0.9rem; /* 폰트 크기 줄임 */
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h2>글쓰기</h2>
			<input type="text" id="title" placeholder="제목" />
			<textarea id="content" rows="5" placeholder="내용"></textarea>
			<input type="file" id="image" accept="image/*" />
			<button id="submit-post">등록</button>
			<a href="./community.html" class="back-button">커뮤니티로 돌아가기</a>
		</div>

		<script>
			$('#submit-post').click(function () {
				const title = $('#title').val().trim();
				const content = $('#content').val().trim();
				const date = new Date().toISOString().split('T')[0];
				const image = $('#image')[0].files[0];

				// 로그인된 유저에서 작성자 이름 가져오기
				const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
				const author = loggedInUser?.name || '익명';

				if (!title || !author || !content) {
					alert('모든 항목을 입력해주세요.');
					return;
				}

				// 이미지 파일 형식 체크
				const allowedTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/gif'];
				if (image && !allowedTypes.includes(image.type)) {
					alert('JPG, PNG, WEBP, GIF 형식의 이미지만 업로드 가능합니다.');
					return;
				}

				if (image) {
					const reader = new FileReader();
					reader.onloadend = function () {
						const imageBase64 = reader.result;
						savePost(imageBase64);
					};
					reader.readAsDataURL(image);
				} else {
					savePost('');
				}

				function savePost(imageBase64) {
					const post = { title, author, content, date, image: imageBase64 };
					const posts = JSON.parse(localStorage.getItem('posts')) || [];

					posts.push(post);
					localStorage.setItem('posts', JSON.stringify(posts));

					alert('게시글이 등록되었습니다.');
					window.location.href = './community.html';
				}
			});
		</script>

		<!-- 공통 헤더 및 푸터 스크립트 로드 (바디 맨 아래에 삽입)-->
		<script defer src="../common/header3.js"></script>
		<script defer src="../common/footer2.js"></script>
	</body>
</html>
